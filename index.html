<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Organizador Fam√≠lia - Fim de Ano</title>
    <style>
        :root {
            /* Palette Completa */
            --slate-50: #f8fafc; --slate-100: #f1f5f9; --slate-200: #e2e8f0; --slate-300: #cbd5e1;
            --slate-400: #94a3b8; --slate-500: #64748b; --slate-600: #475569; --slate-700: #334155; --slate-800: #1e293b;
            
            --yellow-50: #fefce8; --yellow-100: #fef9c3; --yellow-500: #eab308; --yellow-600: #ca8a04;
            --amber-600: #d97706;
            
            --blue-50: #eff6ff; --blue-100: #dbeafe; --blue-400: #60a5fa; --blue-600: #2563eb; --blue-700: #1d4ed8;
            
            --green-50: #f0fdf4; --green-100: #dcfce7; --green-500: #22c55e; --green-600: #16a34a; --green-700: #15803d;

            --red-50: #fef2f2; --red-100: #fee2e2; --red-600: #dc2626;

            --orange-100: #ffedd5; --orange-600: #ea580c;
            --indigo-100: #e0e7ff; --indigo-600: #4f46e5;
            --teal-50: #f0fdfa; --teal-100: #ccfbf1; --teal-600: #0d9488;
            --rose-50: #fff1f2; --rose-100: #ffe4e6; --rose-500: #f43f5e; --rose-600: #e11d48;
            --purple-50: #faf5ff; --purple-100: #f3e8ff; --purple-500: #a855f7; --purple-600: #9333ea;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--slate-50);
            color: var(--slate-700);
            margin: 0;
            padding-bottom: 140px;
            line-height: 1.5;
        }

        /* --- Layout --- */
        .container { max-width: 1000px; margin: 0 auto; padding: 0 16px; }
        .text-center { text-align: center; }
        .hidden { display: none !important; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 8px; }
        
        /* --- Typography --- */
        h1 { margin: 0; font-size: 1.8rem; font-weight: 800; letter-spacing: -0.025em; }
        .subtitle { color: var(--yellow-50); opacity: 0.9; margin-top: 4px; font-weight: 500; font-size: 0.95rem; }
        .font-bold { font-weight: 700; }
        .text-sm { font-size: 0.875rem; }
        .text-xs { font-size: 0.75rem; }
        .uppercase { text-transform: uppercase; }

        /* --- Header --- */
        .header {
            background: linear-gradient(135deg, var(--amber-600), var(--yellow-500));
            color: white;
            padding: 30px 20px 60px;
            text-align: center;
            border-radius: 0 0 24px 24px;
            box-shadow: 0 4px 15px rgba(217, 119, 6, 0.3);
            margin-bottom: 20px;
        }
        
        .location-btn {
            display: inline-flex; align-items: center; gap: 8px;
            background-color: rgba(255, 255, 255, 0.2);
            color: white; padding: 8px 16px; border-radius: 50px;
            text-decoration: none; font-weight: 600; font-size: 0.85rem;
            margin-top: 16px; border: 1px solid rgba(255,255,255,0.4);
            backdrop-filter: blur(4px);
        }

        /* --- Navigation Tabs --- */
        .tabs-wrapper {
            overflow-x: auto;
            white-space: nowrap;
            padding: 0 12px;
            margin-top: -50px;
            margin-bottom: 20px;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        .tabs-wrapper::-webkit-scrollbar { display: none; }
        
        .tabs { display: flex; gap: 8px; padding-bottom: 5px; }
        
        .tab-btn {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 10px 14px; border-radius: 12px;
            font-weight: 600; border: none; cursor: pointer;
            font-size: 0.85rem;
            background-color: rgba(255,255,255,0.9);
            color: var(--slate-500);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.2s;
            flex-shrink: 0;
            border: 1px solid transparent;
        }
        .tab-btn.active { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); background: white; }
        
        /* Active Colors */
        .tab-btn.active-home { color: var(--slate-800); border-color: var(--slate-700); }
        .tab-btn.active-menu { color: var(--yellow-600); border-color: var(--yellow-500); }
        .tab-btn.active-cleaning { color: var(--blue-600); border-color: var(--blue-400); }
        .tab-btn.active-shopping { color: var(--green-600); border-color: var(--green-500); }
        .tab-btn.active-recipes { color: var(--rose-600); border-color: var(--rose-500); }
        .tab-btn.active-members { color: var(--purple-600); border-color: var(--purple-500); }
        .tab-btn.active-contacts { color: var(--slate-600); border-color: var(--slate-400); }
        .tab-btn.active-sos { color: var(--red-600); border-color: var(--red-600); }

        /* --- Cards --- */
        .grid { display: grid; gap: 16px; grid-template-columns: 1fr; }
        @media(min-width: 768px) { .grid { grid-template-columns: repeat(2, 1fr); } }
        
        .card {
            background: white; border-radius: 16px;
            border: 1px solid var(--slate-200);
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
            overflow: hidden;
            display: flex; flex-direction: column;
            margin-bottom: 12px;
        }
        .card.special { border: 2px solid var(--yellow-500); }
        
        /* Collapsible Header Style */
        .card-header { 
            padding: 14px 16px; 
            border-bottom: 1px solid var(--slate-100); 
            display: flex; justify-content: space-between; align-items: center; 
            cursor: pointer; user-select: none;
            transition: background-color 0.2s;
        }
        .card-header:active { background-color: rgba(0,0,0,0.02); }
        
        /* Background Helpers */
        .bg-yellow-light { background: linear-gradient(to right, #fffbeb, #fef3c7); }
        .bg-blue-light { background: linear-gradient(to right, #eff6ff, #dbeafe); }
        .bg-red-light { background: linear-gradient(to right, #fef2f2, #fee2e2); }
        .bg-purple-light { background: linear-gradient(to right, #faf5ff, #f3e8ff); }
        .bg-rose-light { background: linear-gradient(to right, #fff1f2, #ffe4e6); }
        .bg-orange-100 { background: var(--orange-100); color: var(--orange-600); }
        .bg-yellow-100 { background: var(--yellow-100); color: var(--yellow-600); }
        .bg-indigo-100 { background: var(--indigo-100); color: var(--indigo-600); }

        .card-body { padding: 16px; display: block; }
        .card-body.collapsed { display: none; }

        /* --- Items --- */
        .item-row { display: flex; gap: 12px; align-items: flex-start; margin-bottom: 10px; }
        .item-row:last-child { margin-bottom: 0; }
        .icon-box { width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 1.2rem; }
        
        .item-content { flex: 1; }
        .item-label { font-size: 0.65rem; font-weight: 700; text-transform: uppercase; margin-bottom: 1px; }
        .item-title { font-weight: 600; color: var(--slate-700); font-size: 0.9rem; }
        .item-desc { font-size: 0.8rem; color: var(--slate-500); line-height: 1.3; }

        /* --- Shopping List --- */
        .shopping-toolbar { display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px; padding: 12px; background: white; border-radius: 12px; border: 1px solid var(--slate-200); }
        .search-bar { width: 100%; padding: 8px 12px; border: 1px solid var(--slate-300); border-radius: 8px; font-size: 0.9rem; }
        .filters { display: flex; gap: 6px; }
        .filter-btn { padding: 4px 10px; border-radius: 20px; border: 1px solid var(--slate-300); background: white; color: var(--slate-600); font-size: 0.75rem; cursor: pointer; white-space: nowrap; }
        .filter-btn.active { background: var(--green-600); color: white; border-color: var(--green-600); }
        .tools-row { display: flex; justify-content: space-between; margin-top: 4px; }
        .action-btn { font-size: 0.75rem; text-decoration: underline; color: var(--slate-500); background: none; border: none; padding: 0; cursor: pointer; }

        .shopping-table-container { border-radius: 12px; border: 1px solid var(--slate-200); background: white; margin-bottom: 16px; box-shadow: 0 1px 2px rgba(0,0,0,0.03); overflow: hidden; }
        .shopping-category-header { background-color: var(--slate-100); padding: 10px 14px; font-weight: 700; color: var(--slate-700); border-bottom: 1px solid var(--slate-200); cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; }
        
        .shop-item { display: grid; grid-template-columns: 24px 1fr; gap: 8px; padding: 10px 14px; border-bottom: 1px solid var(--slate-100); }
        .shop-item:last-child { border-bottom: none; }
        .shop-item.bought { background-color: var(--green-50); }
        .shop-item.bought .shop-name { text-decoration: line-through; opacity: 0.6; }
        
        .shop-name { font-size: 0.9rem; font-weight: 600; color: var(--slate-700); }
        .shop-meta { font-size: 0.75rem; color: var(--slate-400); margin-top: 2px; }
        .shop-inputs { grid-column: 2 / -1; display: flex; justify-content: space-between; align-items: center; margin-top: 6px; padding-top: 6px; border-top: 1px dashed var(--slate-100); }
        
        .price-input-real { width: 70px; padding: 4px 6px; border: 1px solid var(--slate-300); border-radius: 6px; text-align: right; font-weight: 700; color: var(--green-700); font-size: 0.85rem; }
        .checkbox { width: 18px; height: 18px; cursor: pointer; accent-color: var(--green-600); margin-top: 2px; }

        /* --- Floating Total --- */
        .floating-bar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: var(--slate-800); color: white; padding: 10px 20px; border-radius: 50px; display: none; align-items: center; gap: 16px; box-shadow: 0 8px 20px rgba(0,0,0,0.3); z-index: 1000; width: 90%; max-width: 360px; justify-content: space-around; }
        .float-group { display: flex; flex-direction: column; align-items: center; }
        .float-label { font-size: 0.6rem; text-transform: uppercase; color: var(--slate-400); }
        .float-val { font-weight: 700; font-size: 1rem; }

        /* --- Verse --- */
        .verse-box { text-align: center; padding: 20px 16px; margin-top: 10px; border-top: 1px solid var(--slate-200); display: none; }
        .verse-text { font-family: Georgia, serif; font-style: italic; color: var(--slate-600); font-size: 1rem; margin-bottom: 6px; }
        .verse-ref { font-weight: 700; color: var(--slate-400); font-size: 0.75rem; text-transform: uppercase; }

        /* --- Home --- */
        .welcome-card { background: white; border-radius: 12px; padding: 20px; text-align: center; border: 1px solid var(--slate-200); position: relative; overflow: hidden; margin-bottom: 16px; }
        .welcome-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(to right, var(--amber-600), var(--yellow-500)); }
        .welcome-title { font-size: 1.2rem; font-weight: 800; color: var(--slate-800); margin-bottom: 6px; }
        .verse-highlight { background-color: var(--yellow-50); padding: 16px 12px; border-radius: 12px; text-align: center; border: 2px dashed var(--yellow-200); position: relative; margin-top: 12px; }
        .verse-highlight-text { font-family: Georgia, serif; font-style: italic; font-size: 1rem; color: var(--slate-700); margin-bottom: 6px; line-height: 1.4; }
        .verse-highlight-ref { font-weight: 800; font-size: 0.75rem; color: var(--yellow-600); text-transform: uppercase; letter-spacing: 2px; }
        .nav-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 16px; }
        .nav-card { background: white; border-radius: 10px; padding: 14px; text-align: center; border: 1px solid var(--slate-200); cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .nav-card-icon { width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .nav-card-title { font-weight: 700; color: var(--slate-700); font-size: 0.85rem; }
        
        /* Recipe Specifics */
        .recipe-list { padding-left: 20px; margin: 4px 0 12px 0; font-size: 0.9rem; color: var(--slate-600); }
        .recipe-list li { margin-bottom: 4px; }
        .recipe-section-title { font-size: 0.7rem; font-weight: 700; color: var(--slate-500); text-transform: uppercase; margin-bottom: 4px; margin-top: 12px; }
        .recipe-tag { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 0.65rem; font-weight: 700; text-transform: uppercase; margin-bottom: 4px; }
        .tag-caf√© { background: var(--orange-100); color: var(--orange-600); }
        .tag-almo√ßo { background: var(--yellow-100); color: var(--yellow-600); }
        .tag-jantar { background: var(--indigo-100); color: var(--indigo-600); }
        .ingredients-list { list-style: none; padding: 0; margin: 0; display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 6px; }
        .ingredients-list li { font-size: 0.85rem; color: var(--slate-600); padding: 4px 8px; background-color: var(--slate-50); border-radius: 4px; border: 1px solid var(--slate-100); }
        .steps-list { padding-left: 20px; margin: 0; color: var(--slate-600); font-size: 0.9rem; line-height: 1.4; }
        .steps-list li { margin-bottom: 6px; }
        
        /* Others */
        .contact-item { margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid var(--slate-100); }
        .contact-item:last-child { border-bottom: none; }
        .contact-link { display: inline-block; font-size: 0.75rem; color: var(--blue-600); font-weight: 600; text-decoration: none; background: var(--blue-50); padding: 4px 8px; border-radius: 6px; margin-top: 4px; }
        .sos-alert { background-color: var(--red-50); border: 1px solid var(--red-100); color: var(--red-600); padding: 12px; border-radius: 8px; font-weight: 600; font-size: 0.9rem; margin-top: 8px; }
        
        .chevron { transition: transform 0.2s; color: var(--slate-400); width: 16px; height: 16px; }
        .chevron.rotated { transform: rotate(-90deg); }
    </style>
</head>
<body>

    <div class="header">
        <h1>Fam√≠lia Reunida</h1>
        <p class="subtitle">Fim de Ano 2025/2026</p>
        <a href="https://maps.app.goo.gl/JwUkEGykifmq9f3m9" target="_blank" class="location-btn">
            üìç Ver Localiza√ß√£o
        </a>
    </div>

    <div class="container">
        <!-- Navigation -->
        <div class="tabs-wrapper">
            <div class="tabs">
                <button id="btn-home" class="tab-btn active" onclick="app.navigate('home')">üè† In√≠cio</button>
                <button id="btn-menu" class="tab-btn" onclick="app.navigate('menu')">üçΩÔ∏è Card√°pio</button>
                <button id="btn-cleaning" class="tab-btn" onclick="app.navigate('cleaning')">üßπ Escala</button>
                <button id="btn-shopping" class="tab-btn" onclick="app.navigate('shopping')">üõí Compras</button>
                <button id="btn-recipes" class="tab-btn" onclick="app.navigate('recipes')">üë®‚Äçüç≥ Preparo</button>
                <button id="btn-members" class="tab-btn" onclick="app.navigate('members')">üë• Pessoas</button>
                <button id="btn-contacts" class="tab-btn" onclick="app.navigate('contacts')">üìû Contatos</button>
                <button id="btn-sos" class="tab-btn" onclick="app.navigate('sos')">üöë SOS</button>
            </div>
        </div>

        <div id="app-content"></div>

        <!-- Verse Footer -->
        <div id="verse-footer" class="verse-box">
            <div id="verse-card" class="card" style="display:inline-block; border:1px solid; padding:20px; border-radius:16px; max-width: 600px;">
                <p class="verse-text" id="verse-text">"..."</p>
                <p class="verse-ref" id="verse-ref">REF</p>
            </div>
        </div>
    </div>

    <!-- Floating Shopping Total -->
    <div id="shopping-float" class="floating-bar">
        <div class="float-group"><span class="float-label">Real</span><span class="float-val" id="total-real">R$ 0,00</span></div>
        <div style="width:1px; height:20px; background:rgba(255,255,255,0.3)"></div>
        <div class="float-group"><span class="float-label">Or√ßado</span><span class="float-val" style="color:var(--slate-400)" id="total-est">R$ 0,00</span></div>
    </div>

    <!-- Hidden Input for File Import -->
    <input type="file" id="file-input" style="display: none;" onchange="app.importData(this)">

    <script>
        // --- 1. GLOBAL VARIABLES ---
        var contentArea = document.getElementById('app-content');
        var footerVerseContainer = document.getElementById('verse-footer');
        var floatingTotal = document.getElementById('shopping-float');
        var verseText = document.getElementById('verse-text');
        var verseRef = document.getElementById('verse-ref');
        var verseCard = document.getElementById('verse-card');

        // --- 3. DADOS ---
        var membersMap = {
            'G1-M': 'David, Juliano', 'G2-M': 'Davi, Dirceu, Jhow', 'G3-M': 'Rafael, Felipe', 'G4-M': 'Vinicius, Guilherme',
            'G1-F': 'Thalyta, Vit√≥ria, Michele', 'G2-F': 'Denise, Bruna, Rose', 'G3-F': 'Jaqueline, Neia, Eliane'
        };

        var menuData = [
          { date: '29/dez', day: 'Domingo', empty: true, note: 'Chegada / Organiza√ß√£o (Sem refei√ß√£o oficial)' },
          { date: '30/dez', day: 'Ter√ßa', b: {t:'Caf√© Frio', i:'P√£o franc√™s, presunto e queijo'}, l: {t:'Almo√ßo Leve', i:'Fil√© de frango, arroz e pur√™/salada'}, d: {t:'Noite do Hot Dog', i:'Hot Dog completo com pur√™'} },
          { date: '31/dez', day: 'Quarta', highlight: true, b: {t:'Cuscuz Nordestino', i:'Cuscuz, ovo, queijo, caf√©'}, l: {t:'Pr√©-R√©veillon', i:'Fil√© de frango, arroz e pur√™/salada'}, d: {t:'‚ú® CHURRASCO DA VIRADA ‚ú®', i:'Carnes, acompanhamentos e festa!'} },
          { date: '01/jan', day: 'Quinta', highlight: true, b: {t:'Caf√© da Ressaca', i:'Frio (p√£o franc√™s, presunto, queijo)'}, l: {t:'‚ú® Churrasco de Ano Novo ‚ú®', i:'Continua√ß√£o da festa (Maminha, sobras)'}, d: {t:'Noite do Macarr√£o', i:'Macarr√£o com carne mo√≠da'} },
          { date: '02/jan', day: 'Sexta', b: {t:'Caf√© Nordestino', i:'Cuscuz com ovo e queijo + p√£o franc√™s'}, l: {t:'Almo√ßo Favorito', i:'Strogonoff de carne, arroz e batata palha'}, d: {t:'Noite do Macarr√£o', i:'Macarr√£o com carne mo√≠da'} },
          { date: '03/jan', day: 'S√°bado', b: {t:'Caf√© Variado', i:'P√£es variados e ovos'}, l: {t:'Almo√ßo Leve', i:'Fil√© de frango, arroz e pur√™/salada'}, d: {t:'Hamburgada', i:'Hamb√∫rguer artesanal'} },
          { date: '04/jan', day: 'Domingo', b: {t:'Caf√© da Despedida', i:'Cuscuz com ovo e queijo + p√£o franc√™s'}, l: {t:'√öltimo Almo√ßo', i:'Fil√© de frango, arroz e pur√™/salada'}, d: null }
        ];

        var cleaningData = [
          { date: '30/dez', cafe: 'G4-M', almocoM: 'G3-F', almocoL: 'G3-M', jantarM: 'G2-F', jantarL: 'G2-M' },
          { date: '31/dez', cafe: 'G3-M', almocoM: 'G1-F', almocoL: 'G4-M', jantarM: 'G3-F', jantarL: 'G1-M' },
          { date: '01/jan', cafe: 'G2-M', almocoM: 'G2-F', almocoL: 'G3-M', jantarM: 'G1-F', jantarL: 'G4-M' },
          { date: '02/jan', cafe: 'G4-M', almocoM: 'G1-F', almocoL: 'G1-M', jantarM: 'G2-F', jantarL: 'G2-M' },
          { date: '03/jan', cafe: 'G3-M', almocoM: 'G1-F', almocoL: 'G2-M', jantarM: 'G3-F', jantarL: 'G1-M' }, 
          { date: '04/jan', cafe: 'G1-M', almocoM: 'G3-F', almocoL: 'G2-M', jantarM: '-', jantarL: '-' } 
        ];

        var membersGroups = [
            { id: 'G1', color: 'blue', female: 'Thalyta, Vit√≥ria, Michele', male: 'David, Juliano' },
            { id: 'G2', color: 'orange', female: 'Denise, Bruna, Rose', male: 'Davi, Dirceu, Jhow' },
            { id: 'G3', color: 'green', female: 'Jaqueline, Neia, Eliane', male: 'Rafael, Felipe' },
            { id: 'G4', color: 'purple', female: '-', male: 'Vinicius, Guilherme' },
            { id: 'Kids & Teens', color: 'teal', type: 'mixed', list: 'Davi, Enzo, √Ågatha, Anthony, Isaac, Pedro H., Manuella, Maria V., Maria C., Miguel, Adrian, Laura, L√°zaro, Pedro Gabriel, Thiago Henry' }
        ];

        var defaultShoppingList = [
            // Descart√°veis
            { id: '1', category: 'Descart√°veis', name: 'Copo desc. 200ml', unit: 'pct', qty: 15, unitPrice: 12.00, totalEst: 180.00, realPrice: 0, bought: false },
            { id: '2', category: 'Descart√°veis', name: 'Prato desc.', unit: 'pct', qty: 20, unitPrice: 18.00, totalEst: 360.00, realPrice: 0, bought: false },
            { id: '3', category: 'Descart√°veis', name: 'Talheres desc.', unit: 'pct', qty: 20, unitPrice: 20.00, totalEst: 400.00, realPrice: 0, bought: false },
            { id: '4', category: 'Descart√°veis', name: 'Guardanapo', unit: 'pct', qty: 8, unitPrice: 8.00, totalEst: 64.00, realPrice: 0, bought: false },
            { id: '5', category: 'Descart√°veis', name: 'Papel toalha', unit: 'rolo', qty: 12, unitPrice: 6.50, totalEst: 78.00, realPrice: 0, bought: false },
            { id: '6', category: 'Descart√°veis', name: 'Bandeja alum. G', unit: 'un', qty: 25, unitPrice: 3.50, totalEst: 87.50, realPrice: 0, bought: false },
            { id: '7', category: 'Descart√°veis', name: 'Bandeja alum. M', unit: 'un', qty: 30, unitPrice: 2.80, totalEst: 84.00, realPrice: 0, bought: false },
            { id: '8', category: 'Descart√°veis', name: 'Papel alum√≠nio', unit: 'rolo', qty: 3, unitPrice: 12.00, totalEst: 36.00, realPrice: 0, bought: false },
            { id: '9', category: 'Descart√°veis', name: 'Filme pl√°stico', unit: 'rolo', qty: 3, unitPrice: 8.00, totalEst: 24.00, realPrice: 0, bought: false },
            // Mercado
            { id: '10', category: 'Mercado', name: 'Arroz', unit: 'kg', qty: 25, unitPrice: 7.20, totalEst: 180.00, realPrice: 0, bought: false },
            { id: '11', category: 'Mercado', name: 'Macarr√£o', unit: 'kg', qty: 8, unitPrice: 8.90, totalEst: 71.20, realPrice: 0, bought: false },
            { id: '12', category: 'Mercado', name: 'Molho Tomate', unit: 'kg', qty: 6, unitPrice: 12.00, totalEst: 72.00, realPrice: 0, bought: false },
            { id: '13', category: 'Mercado', name: '√ìleo', unit: 'L', qty: 6, unitPrice: 8.50, totalEst: 51.00, realPrice: 0, bought: false },
            { id: '14', category: 'Mercado', name: 'Sal', unit: 'kg', qty: 4, unitPrice: 4.50, totalEst: 18.00, realPrice: 0, bought: false },
            { id: '15', category: 'Mercado', name: 'A√ß√∫car', unit: 'kg', qty: 12, unitPrice: 4.80, totalEst: 57.60, realPrice: 0, bought: false },
            { id: '16', category: 'Mercado', name: 'Caf√© p√≥', unit: 'kg', qty: 10, unitPrice: 30.00, totalEst: 300.00, realPrice: 0, bought: false },
            { id: '17', category: 'Mercado', name: 'Leite', unit: 'L', qty: 60, unitPrice: 4.80, totalEst: 288.00, realPrice: 0, bought: false },
            { id: '18', category: 'Mercado', name: 'Floc√£o Milho', unit: 'kg', qty: 33, unitPrice: 9.90, totalEst: 326.70, realPrice: 0, bought: false },
            { id: '19', category: 'Mercado', name: 'Batata palha', unit: 'kg', qty: 6, unitPrice: 31.00, totalEst: 186.00, realPrice: 0, bought: false },
            { id: '20', category: 'Mercado', name: 'Farofa', unit: 'kg', qty: 9, unitPrice: 19.00, totalEst: 171.00, realPrice: 0, bought: false },
            { id: '21', category: 'Mercado', name: 'Milho verde', unit: 'lata', qty: 24, unitPrice: 6.00, totalEst: 144.00, realPrice: 0, bought: false },
            { id: '22', category: 'Mercado', name: 'Ervilha', unit: 'lata', qty: 24, unitPrice: 6.50, totalEst: 156.00, realPrice: 0, bought: false },
            { id: '23', category: 'Mercado', name: 'Maionese', unit: 'kg', qty: 8, unitPrice: 22.00, totalEst: 176.00, realPrice: 0, bought: false },
            { id: '24', category: 'Mercado', name: 'Ketchup', unit: 'kg', qty: 4, unitPrice: 12.00, totalEst: 48.00, realPrice: 0, bought: false },
            { id: '25', category: 'Mercado', name: 'Mostarda', unit: 'kg', qty: 4, unitPrice: 12.00, totalEst: 48.00, realPrice: 0, bought: false },
            { id: '26', category: 'Mercado', name: 'Suco', unit: 'L', qty: 40, unitPrice: 6.50, totalEst: 260.00, realPrice: 0, bought: false },
            { id: '26b', category: 'Mercado', name: 'Feij√£o', unit: 'kg', qty: 15, unitPrice: 8.00, totalEst: 120.00, realPrice: 0, bought: false },
            { id: '26c', category: 'Mercado', name: 'Sal Grosso', unit: 'kg', qty: 5, unitPrice: 4.50, totalEst: 22.50, realPrice: 0, bought: false },
            { id: '26d', category: 'Mercado', name: 'Massa Pastel', unit: 'rolo', qty: 10, unitPrice: 12.00, totalEst: 120.00, realPrice: 0, bought: false },
            { id: '26e', category: 'Mercado', name: '√Ålcool 70%', unit: 'L', qty: 2, unitPrice: 10.00, totalEst: 20.00, realPrice: 0, bought: false },
            { id: '26f', category: 'Mercado', name: 'Temperos', unit: 'kit', qty: 1, unitPrice: 50.00, totalEst: 50.00, realPrice: 0, bought: false },
            { id: '52', category: 'Mercado', name: 'Carv√£o (Saco)', unit: 'un', qty: 5, unitPrice: 35.00, totalEst: 175.00, realPrice: 0, bought: false },
            // A√ßougue (Ajustado PDF)
            { id: '27', category: 'A√ßougue', name: 'Fil√© Frango', unit: 'kg', qty: 30, unitPrice: 27.00, totalEst: 810.00, realPrice: 0, bought: false },
            { id: '28', category: 'A√ßougue', name: 'Patinho Mo√≠do', unit: 'kg', qty: 7, unitPrice: 44.99, totalEst: 314.93, realPrice: 0, bought: false },
            { id: '29', category: 'A√ßougue', name: 'Maminha', unit: 'kg', qty: 6, unitPrice: 52.00, totalEst: 312.00, realPrice: 0, bought: false },
            { id: '30', category: 'A√ßougue', name: 'Contra-fil√©', unit: 'kg', qty: 5, unitPrice: 54.99, totalEst: 274.95, realPrice: 0, bought: false },
            { id: '31', category: 'A√ßougue', name: 'Picanha', unit: 'kg', qty: 3, unitPrice: 69.99, totalEst: 209.97, realPrice: 0, bought: false },
            { id: '32', category: 'A√ßougue', name: 'Lingui√ßa', unit: 'kg', qty: 7, unitPrice: 26.99, totalEst: 188.93, realPrice: 0, bought: false },
            { id: '33', category: 'A√ßougue', name: 'Tulipa Frango', unit: 'kg', qty: 2.5, unitPrice: 7.99, totalEst: 19.98, realPrice: 0, bought: false },
            { id: '34', category: 'A√ßougue', name: 'Coxinha Asa', unit: 'kg', qty: 2.5, unitPrice: 17.99, totalEst: 44.98, realPrice: 0, bought: false },
            { id: '35', category: 'A√ßougue', name: 'Salsicha', unit: 'kg', qty: 6, unitPrice: 18.00, totalEst: 108.00, realPrice: 0, bought: false },
            { id: '36', category: 'A√ßougue', name: 'Hamb√∫rguer (patinho)', unit: 'kg', qty: 5, unitPrice: 44.99, totalEst: 224.95, realPrice: 0, bought: false },
             // Hortifruti
            { id: '37', category: 'Hortifruti', name: 'Alface', unit: 'p√©', qty: 40, unitPrice: 4.50, totalEst: 180.00, realPrice: 0, bought: false },
            { id: '38', category: 'Hortifruti', name: 'Tomate', unit: 'kg', qty: 36, unitPrice: 8.90, totalEst: 320.40, realPrice: 0, bought: false },
            { id: '39', category: 'Hortifruti', name: 'Cebola', unit: 'kg', qty: 20, unitPrice: 7.50, totalEst: 150.00, realPrice: 0, bought: false },
            { id: '40', category: 'Hortifruti', name: 'Batata', unit: 'kg', qty: 35, unitPrice: 6.90, totalEst: 241.50, realPrice: 0, bought: false },
            { id: '41', category: 'Hortifruti', name: 'Cenoura', unit: 'kg', qty: 12, unitPrice: 6.50, totalEst: 78.00, realPrice: 0, bought: false },
            { id: '42', category: 'Hortifruti', name: 'Lim√£o', unit: 'kg', qty: 12, unitPrice: 7.50, totalEst: 90.00, realPrice: 0, bought: false },
            { id: '43', category: 'Hortifruti', name: 'Piment√£o', unit: 'kg', qty: 6, unitPrice: 9.50, totalEst: 57.00, realPrice: 0, bought: false },
             { id: '55', category: 'Hortifruti', name: 'Alho', unit: 'kg', qty: 1, unitPrice: 30.00, totalEst: 30.00, realPrice: 0, bought: false },
             { id: '62', category: 'Hortifruti', name: 'Cheiro Verde', unit: 'ma√ßo', qty: 10, unitPrice: 3.50, totalEst: 35.00, realPrice: 0, bought: false },
            // Padaria
            { id: '44', category: 'Padaria', name: 'P√£o franc√™s', unit: 'un', qty: 260, unitPrice: 1.00, totalEst: 260.00, realPrice: 0, bought: false },
            { id: '45', category: 'Padaria', name: 'P√£o de hot dog', unit: 'un', qty: 80, unitPrice: 1.20, totalEst: 96.00, realPrice: 0, bought: false },
            { id: '46', category: 'Padaria', name: 'P√£o de hamb√∫rguer', unit: 'un', qty: 50, unitPrice: 1.60, totalEst: 80.00, realPrice: 0, bought: false },
            { id: '47', category: 'Padaria', name: 'P√£o de alho', unit: 'un', qty: 60, unitPrice: 2.80, totalEst: 168.00, realPrice: 0, bought: false },
            { id: '48', category: 'Padaria', name: 'Ingr. P√£o Caseiro', unit: 'kit', qty: 4, unitPrice: 25.00, totalEst: 100.00, realPrice: 0, bought: false },
             { id: '48b', category: 'Padaria', name: 'P√£o Pullman', unit: 'un', qty: 12, unitPrice: 12.00, totalEst: 144.00, realPrice: 0, bought: false },
             { id: '48c', category: 'Padaria', name: 'P√£o Sovado', unit: 'un', qty: 12, unitPrice: 8.00, totalEst: 96.00, realPrice: 0, bought: false },
            // Bebidas
            { id: '49', category: 'Bebidas', name: '√Ågua 20L', unit: 'un', qty: 10, unitPrice: 20.00, totalEst: 200.00, realPrice: 0, bought: false },
             { id: '50', category: 'Bebidas', name: 'Suco Natural Campo Verde', unit: 'L', qty: 37, unitPrice: 6.50, totalEst: 240.50, realPrice: 0, bought: false },
             { id: '50b', category: 'Bebidas', name: 'Coca-Cola Zero', unit: 'L', qty: 86, unitPrice: 6.00, totalEst: 516.00, realPrice: 0, bought: false },
            // Frios/Laticinios/Outros
            { id: '51', category: 'Frios e Latic√≠nios', name: 'Ovos (Cartela 30un)', unit: 'un', qty: 17, unitPrice: 18.00, totalEst: 306.00, realPrice: 0, bought: false },
            { id: '52', category: 'Frios e Latic√≠nios', name: 'Manteiga/Margarina (500g)', unit: 'un', qty: 3, unitPrice: 18.00, totalEst: 54.00, realPrice: 0, bought: false },
            { id: '53', category: 'Frios e Latic√≠nios', name: 'Presunto', unit: 'kg', qty: 4, unitPrice: 28.00, totalEst: 112.00, realPrice: 0, bought: false },
            { id: '54', category: 'Frios e Latic√≠nios', name: 'Mussarela', unit: 'kg', qty: 4, unitPrice: 35.00, totalEst: 140.00, realPrice: 0, bought: false },
             { id: '63', category: 'Frios e Latic√≠nios', name: 'Queijo Coalho', unit: 'kg', qty: 6, unitPrice: 35.00, totalEst: 210.00, realPrice: 0, bought: false },
             { id: '64', category: 'Frios e Latic√≠nios', name: 'Creme de Leite', unit: 'cx', qty: 10, unitPrice: 4.50, totalEst: 45.00, realPrice: 0, bought: false },
             { id: '65', category: 'Frios e Latic√≠nios', name: 'Champignon', unit: 'kg', qty: 1, unitPrice: 45.00, totalEst: 45.00, realPrice: 0, bought: false },
             // Limpeza (Atualizado PDF)
             { id: '56', category: 'Limpeza / Uso Geral', name: 'Detergente', unit: 'un', qty: 10, unitPrice: 2.50, totalEst: 25.00, realPrice: 0, bought: false },
            { id: '57', category: 'Limpeza / Uso Geral', name: 'Esponja', unit: 'un', qty: 10, unitPrice: 1.50, totalEst: 15.00, realPrice: 0, bought: false },
            { id: '58', category: 'Limpeza / Uso Geral', name: 'Saco de Lixo 100L', unit: 'pct', qty: 14, unitPrice: 12.00, totalEst: 168.00, realPrice: 0, bought: false },
            { id: '59', category: 'Limpeza / Uso Geral', name: 'Papel Higi√™nico (Fardo)', unit: 'pct', qty: 12, unitPrice: 20.00, totalEst: 240.00, realPrice: 0, bought: false },
            { id: '60', category: 'Limpeza / Uso Geral', name: 'Pano de ch√£o', unit: 'un', qty: 10, unitPrice: 8.00, totalEst: 80.00, realPrice: 0, bought: false },
             { id: '61', category: 'Limpeza / Uso Geral', name: 'F√≥sforo / Isqueiro', unit: 'un', qty: 2, unitPrice: 5.00, totalEst: 10.00, realPrice: 0, bought: false },
             { id: '66', category: 'Limpeza / Uso Geral', name: 'Desinfetante (1L)', unit: 'un', qty: 6, unitPrice: 8.00, totalEst: 48.00, realPrice: 0, bought: false },
             { id: '67', category: 'Limpeza / Uso Geral', name: 'Luvas descart√°veis', unit: 'cx', qty: 6, unitPrice: 25.00, totalEst: 150.00, realPrice: 0, bought: false },
             { id: '68', category: 'Limpeza / Uso Geral', name: 'Sab√£o em p√≥', unit: 'kg', qty: 2, unitPrice: 15.00, totalEst: 30.00, realPrice: 0, bought: false },
             { id: '69', category: 'Limpeza / Uso Geral', name: 'Pano de Prato', unit: 'un', qty: 5, unitPrice: 5.00, totalEst: 25.00, realPrice: 0, bought: false },
             { id: '70', category: 'Limpeza / Uso Geral', name: '√Ågua Sanit√°ria', unit: 'un', qty: 6, unitPrice: 5.00, totalEst: 30.00, realPrice: 0, bought: false }
        ];

        var recipesData = [
            {
                date: '30/dez - Ter√ßa',
                meals: [
                    { t: 'Caf√©: P√£o com Ovos', tag: 'tag-caf√©', ingredients: ['65 P√£es franceses', 'Manteiga', 'Ovos', 'Caf√©', 'Leite'], 
                      st: ['Prepare caf√© em garrafas t√©rmicas.', 'Aque√ßa o leite sem ferver.', 'Corte os p√£es.', 'Fa√ßa ovos mexidos em levas de 20-30 para n√£o esfriar.'] },
                    { t: 'Almo√ßo: PF Frango', tag: 'tag-almo√ßo', ingredients: ['10kg Arroz', '10kg Fil√© de Frango', '10 Alfaces', '8kg Tomate', '2L √ìleo', '3kg Cebola'], 
                      st: ['Arroz: refogue bem.', 'Frango: chapa quente aos poucos.', 'Salada: higienizar.'] },
                    { t: 'Jantar: Hot Dog', tag: 'tag-jantar', ingredients: ['65 P√£es Hot Dog', '10kg Salsicha', '6kg Molho', '8kg Batata (Pur√™)', '2L Leite', '2kg Batata Palha'], 
                      st: ['Pur√™: cozinhe batatas, amasse com leite/manteiga.', 'Salsicha: ferva antes, depois molho.', 'Servir: esta√ß√£o de montagem.'] }
                ]
            },
            {
                date: '31/dez - Quarta',
                meals: [
                    { t: 'Caf√©: Cuscuz', tag: 'tag-caf√©', ingredients: ['8kg Floc√£o', '2kg Queijo', '1kg Manteiga', '100 Ovos', '10L Leite'], 
                      st: ['Hidrate floc√£o (500ml/pct). Cozinhe vapor. Sirva com queijo/ovo.'] },
                    { t: 'Almo√ßo: Leve', tag: 'tag-almo√ßo', ingredients: ['10kg Arroz', '10kg Frango', 'Salada'], st: ['Repetir preparo b√°sico.', 'Manter leve para a ceia.'] },
                    { t: 'Jantar: CHURRASCO VIRADA', tag: 'tag-jantar', ingredients: ['3kg Picanha', '5kg Contra-fil√©', '7kg Lingui√ßa', '4kg Tulipa', '2.5kg Coxinha', '30 P√£es Alho', '5kg Farofa', 'Vinagrete'], 
                      st: ['Acenda carv√£o cedo.', 'Comece por lingui√ßa/frango/p√£o alho.', 'Salgue carnes nobres com sal grosso na hora.'] }
                ]
            },
            {
                date: '01/jan - Quinta',
                meals: [
                    { t: 'Caf√©: Ressaca', tag: 'tag-caf√©', ingredients: ['65 P√£es', 'Frios', 'Ovos', 'Caf√© forte'], st: ['Praticidade.'] },
                    { t: 'Almo√ßo: Churrasco Cont.', tag: 'tag-almo√ßo', ingredients: ['6kg Maminha', 'Carnes restantes', 'Arroz', 'Farofa'], st: ['Reacenda churrasqueira.', 'Asse Maminha.', 'Arroz fresco.'] },
                    { t: 'Jantar: Macarr√£o com Carne Mo√≠da', tag: 'tag-jantar', ingredients: ['8kg Macarr√£o', '7kg Carne Mo√≠da', '6kg Molho Tomate'], st: ['Refogue carne bem seca.', 'Cozinhe o macarr√£o.', 'Misture com molho.'] }
                ]
            },
            {
                date: '02/jan - Sexta',
                meals: [
                    { t: 'Caf√©: Cuscuz', tag: 'tag-caf√©', ingredients: ['8kg Floc√£o', 'Queijo', 'Ovos'], st: ['Cuscuz tradicional.'] },
                    { t: 'Almo√ßo: Strogonoff', tag: 'tag-almo√ßo', ingredients: ['10kg Carne (cubos)', '10cx Creme Leite', '4kg Molho', '1kg Champignon', '10kg Arroz', '3kg Batata Palha'], 
                      st: ['Sele carne aos poucos.', 'Junte molho/ketchup/mostarda.', 'Desligue e ponha creme leite.'] },
                    { t: 'Jantar: Macarr√£o', tag: 'tag-jantar', ingredients: ['8kg Macarr√£o', '5kg Carne Mo√≠da', 'Molho Tomate'], st: ['Molho bolonhesa rico.', 'Macarr√£o al dente.'] }
                ]
            },
             {
                date: '03/jan - S√°bado',
                meals: [
                     { t: 'Caf√©: Variado', tag: 'tag-caf√©', ingredients: ['P√£es', 'Ovos', 'Frios'], st: ['B√°sico.'] },
                     { t: 'Almo√ßo: Leve', tag: 'tag-almo√ßo', ingredients: ['Arroz', 'Frango', 'Salada'], st: ['B√°sico.'] },
                     { t: 'Jantar: Hamburgada', tag: 'tag-jantar', ingredients: ['5kg Carne Mo√≠da', '50 P√£es', 'Queijo', 'Salada', 'Condimentos'], st: ['Molde 140g.', 'Chapa quente.', 'Monte na hora.'] }
                ]
            },
            {
                date: '04/jan - Domingo',
                meals: [
                     { t: 'Caf√©: Despedida', tag: 'tag-caf√©', ingredients: ['Tudo que sobrou (Cuscuz/P√£o)'], st: ['Limpa estoque.'] },
                     { t: 'Almo√ßo: √öltimo', tag: 'tag-almo√ßo', ingredients: ['Limpa geladeira'], st: ['Criatividade com as sobras.'] }
                ]
            }
        ];

        var verses = {
            home: { t: "Por√©m eu e a minha casa serviremos ao Senhor.", r: "Josu√© 24:15", c: "--yellow" },
            menu: { t: "Quer comais quer bebais... fazei tudo para gl√≥ria de Deus.", r: "1 Cor√≠ntios 10:31", c: "--yellow" },
            cleaning: { t: "Tudo o que fizerem, fa√ßam de todo o cora√ß√£o...", r: "Colossenses 3:23", c: "--blue" },
            shopping: { t: "O meu Deus suprir√° todas as necessidades...", r: "Filipenses 4:19", c: "--green" },
            recipes: { t: "D√°-nos hoje o nosso p√£o de cada dia.", r: "Mateus 6:11", c: "--rose" },
            members: { t: "Oh! qu√£o bom e qu√£o suave √© que os irm√£os vivam em uni√£o.", r: "Salmos 133:1", c: "--purple" },
            contacts: { t: "O Senhor guardar√° a tua sa√≠da e a tua entrada.", r: "Salmos 121:8", c: "--slate" },
            sos: { t: "Deus √© o nosso ref√∫gio e fortaleza.", r: "Salmos 46:1", c: "--red" }
        };

        // --- 2. APP LOGIC ---
        var app = {
            state: { 
                shoppingList: [],
                filterType: 'all', // all, pending, bought
                searchTerm: ''
            },
            dom: {},

            init: function() {
                // Initialize DOM references reliably
                this.dom.contentArea = document.getElementById('app-content');
                this.dom.floatingTotal = document.getElementById('shopping-float');
                this.dom.verseFooter = document.getElementById('verse-footer');
                this.dom.verseText = document.getElementById('verse-text');
                this.dom.verseRef = document.getElementById('verse-ref');
                this.dom.verseCard = document.getElementById('verse-card');
                this.dom.totalReal = document.getElementById('total-real');
                this.dom.totalEst = document.getElementById('total-est');

                var saved = localStorage.getItem('family_final_v44');
                if(saved) { 
                    this.state.shoppingList = JSON.parse(saved); 
                    if(this.state.shoppingList.length !== defaultShoppingList.length) {
                         this.state.shoppingList = defaultShoppingList.map(function(i) { return { ...i, bought: false, realUnit: 0, totalEst: i.qty * i.unitPrice }; });
                    }
                }
                else { 
                    this.state.shoppingList = defaultShoppingList.map(function(i) { return { ...i, bought: false, realUnit: 0, totalEst: i.qty * i.unitPrice }; }); 
                }
                this.navigate('home');
            },

            save: function() {
                localStorage.setItem('family_final_v44', JSON.stringify(this.state.shoppingList));
                this.updateTotals();
            },

            updateTotals: function() {
                var real = 0, est = 0;
                this.state.shoppingList.forEach(function(i) {
                    est += i.totalEst;
                    if(i.bought) real += (i.realUnit * i.qty);
                });
                if(this.dom.totalReal) this.dom.totalReal.innerText = real.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
                if(this.dom.totalEst) this.dom.totalEst.innerText = "Or√ß: " + est.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
            },

            navigate: function(tab) {
                document.querySelectorAll('.tab-btn').forEach(function(btn) {
                    btn.classList.remove('active');
                    if(btn.id === 'btn-' + tab) btn.classList.add('active');
                });

                if(this.dom.floatingTotal) this.dom.floatingTotal.style.display = (tab === 'shopping') ? 'flex' : 'none';
                if(this.dom.verseFooter) this.dom.verseFooter.style.display = (tab === 'home') ? 'none' : 'block';

                if (tab === 'home') this.renderHome();
                else if (tab === 'menu') this.renderMenu();
                else if (tab === 'cleaning') this.renderCleaning();
                else if (tab === 'shopping') this.renderShopping();
                else if (tab === 'recipes') this.renderRecipes();
                else if (tab === 'members') this.renderMembers();
                else if (tab === 'contacts') this.renderContacts();
                else if (tab === 'sos') this.renderSOS();

                var v = verses[tab] || verses['home'];
                if(v && this.dom.verseText && this.dom.verseRef && this.dom.verseCard) {
                    this.dom.verseText.innerText = `"${v.t}"`;
                    this.dom.verseRef.innerText = v.r;
                    this.dom.verseCard.style.borderColor = `var(${v.c}-200)`;
                    this.dom.verseRef.style.color = `var(${v.c}-600)`;
                }
            },

            renderHome: function() {
                this.dom.contentArea.innerHTML = `
                    <div class="welcome-card"><div class="font-bold text-lg">Bem-vindos! üëã</div><div>Organiza√ß√£o Fam√≠lia 2025/2026</div></div>
                    <div class="verse-highlight"><div class="verse-highlight-text">"Por√©m eu e a minha casa serviremos ao Senhor."</div><div class="verse-highlight-ref">Josu√© 24:15</div></div>
                    <div class="nav-grid">
                        <div class="nav-card" onclick="app.navigate('menu')">üçΩÔ∏è Card√°pio</div>
                        <div class="nav-card" onclick="app.navigate('shopping')">üõí Compras</div>
                        <div class="nav-card" onclick="app.navigate('cleaning')">üßπ Escala</div>
                        <div class="nav-card" onclick="app.navigate('members')">üë• Integrantes</div>
                        <div class="nav-card" onclick="app.navigate('contacts')">üìû Contatos</div>
                    </div>`;
            },

            renderMenu: function() {
                var html = '<div class="grid">';
                menuData.forEach((d) => {
                    html += `<div class="card">
                        <div class="card-header bg-yellow-light uppercase text-xs font-black">${d.day} (${d.date})</div>
                        <div class="card-body text-sm">
                            ${d.empty ? `<div class="text-slate-400 italic">${d.note}</div>` : `
                                <div class="mb-2"><strong>‚òï Caf√©:</strong> ${d.b.t}<br><span class="text-xs text-slate-500">${d.b.i}</span></div>
                                <div class="mb-2"><strong>‚òÄÔ∏è Almo√ßo:</strong> ${d.l.t}<br><span class="text-xs text-slate-500">${d.l.i}</span></div>
                                ${d.d ? `<div><strong>üåô Jantar:</strong> ${d.d.t}<br><span class="text-xs text-slate-500">${d.d.i}</span></div>` : ''}
                            `}
                        </div>
                    </div>`;
                });
                this.dom.contentArea.innerHTML = html + '</div>';
            },

            renderCleaning: function() {
                var html = `<div class="card" style="margin-bottom:12px; border:1px solid var(--teal-200); background:var(--teal-50);"><div class="card-body flex items-center gap-4"><div style="font-size:1.5rem">ü§ù</div><div><div class="font-bold text-teal-700 uppercase text-xs">Conscientiza√ß√£o</div><div class="text-sm text-teal-600">√Åreas comuns s√£o dever de TODOS. Quartos e banheiros privativos s√£o responsabilidade de cada ocupante.</div></div></div></div>`;
                html += '<div class="grid">';
                cleaningData.forEach((d) => {
                     html += `<div class="card">
                        <div class="card-header bg-blue-light uppercase text-xs font-black">${d.date}</div>
                        <div class="card-body text-sm">
                            <div class="mb-3"><strong>‚òï Caf√©:</strong> <span class="text-blue-600 font-bold">${d.cafe}</span><br><span class="text-xs text-slate-400">(${membersMap[d.cafe]})</span></div>
                            <div class="mb-3"><strong>‚òÄÔ∏è Almo√ßo:</strong><br><span class="text-xs font-bold text-slate-600">Prep: ${d.almocoM} / Lav: ${d.almocoL}</span><br><span class="text-[10px] text-slate-400">(${membersMap[d.almocoM]} / ${membersMap[d.almocoL]})</span></div>
                            ${d.jantarM !== '-' ? `<div><strong>üåô Jantar:</strong><br><span class="text-xs font-bold text-slate-600">Prep: ${d.jantarM} / Lav: ${d.jantarL}</span><br><span class="text-[10px] text-slate-400">(${membersMap[d.jantarM]} / ${membersMap[d.jantarL]})</span></div>` : '<div class="text-slate-300 italic text-xs">Sem escala oficial</div>'}
                        </div>
                     </div>`;
                });
                this.dom.contentArea.innerHTML = html + '</div>';
            },

            renderShopping: function() {
                var html = `<div class="shopping-toolbar"><input type="text" id="shop-search" class="search-bar" placeholder="Buscar..." onkeyup="app.filterShopping()"><div class="filters"><button class="filter-btn active" onclick="app.setFilter(this, 'all')">Todos</button><button class="filter-btn" onclick="app.setFilter(this, 'pending')">Pendentes</button><button class="filter-btn" onclick="app.setFilter(this, 'bought')">Comprados</button></div><div class="tools-row"><button class="action-btn" onclick="app.resetData()">Resetar</button><button class="action-btn" onclick="app.exportData()">Exportar</button></div></div><div id="shopping-list-container"></div>`;
                this.dom.contentArea.innerHTML = html;
                this.renderShoppingListItems();
                this.updateTotals();
            },

            renderShoppingListItems: function() {
                var container = document.getElementById('shopping-list-container');
                if(!container) return;
                
                var filtered = this.state.shoppingList.filter(item => {
                    var matchesText = item.name.toLowerCase().includes(this.state.searchTerm.toLowerCase());
                    if (this.state.filterType === 'pending') return matchesText && !item.bought;
                    if (this.state.filterType === 'bought') return matchesText && item.bought;
                    return matchesText;
                });

                var categories = {};
                filtered.forEach(item => {
                    if(!categories[item.category]) categories[item.category] = [];
                    categories[item.category].push(item);
                });

                var html = '';
                for (var cat in categories) {
                    html += `<div class="shopping-table-container">
                        <div class="shopping-category-header">${cat} <span style="font-weight:400; opacity:0.7">(${categories[cat].length})</span></div>`;
                    
                    categories[cat].forEach(item => {
                        html += `<div class="shop-item ${item.bought ? 'bought' : ''}">
                            <div><input type="checkbox" class="checkbox" ${item.bought ? 'checked' : ''} onchange="app.toggleCheck('${item.id}')"></div>
                            <div>
                                <div class="shop-name">${item.name}</div>
                                <div class="shop-meta">${item.qty} ${item.unit} x R$ ${item.unitPrice.toFixed(2)} = Total Est: R$ ${item.totalEst.toFixed(2)}</div>
                                <div class="shop-inputs" ${item.bought ? 'style="display:flex"' : 'style="display:none"'}>
                                    <span style="font-size:0.75rem; color:var(--green-600); font-weight:700;">Pre√ßo Real Un:</span>
                                    <input type="number" class="price-input-real" value="${item.realUnit || ''}" placeholder="0.00" onchange="app.updatePrice('${item.id}', this.value)">
                                </div>
                            </div>
                        </div>`;
                    });
                    html += `</div>`;
                }
                if(html === '') html = '<div class="text-center p-4 text-slate-400">Nenhum item encontrado.</div>';
                container.innerHTML = html;
            },

            toggleCheck: function(id) {
                var item = this.state.shoppingList.find(i => i.id === id);
                if(item) {
                    item.bought = !item.bought;
                    this.save();
                    this.renderShoppingListItems(); // Re-render to show/hide inputs
                }
            },

            updatePrice: function(id, val) {
                var item = this.state.shoppingList.find(i => i.id === id);
                if(item) {
                    item.realUnit = parseFloat(val) || 0;
                    this.save();
                }
            },

            filterShopping: function() {
                var input = document.getElementById('shop-search');
                this.state.searchTerm = input.value;
                this.renderShoppingListItems();
            },

            setFilter: function(btn, type) {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                this.state.filterType = type;
                this.renderShoppingListItems();
            },

            resetData: function() {
                if(confirm('Tem certeza que deseja resetar todos os dados?')) {
                    this.state.shoppingList = defaultShoppingList.map(function(i) { return { ...i, bought: false, realUnit: 0, totalEst: i.qty * i.unitPrice }; });
                    this.save();
                    this.renderShoppingListItems();
                }
            },

            exportData: function() {
                var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(this.state.shoppingList));
                var downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", "compras_familia.json");
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
            },

            renderRecipes: function() {
                var html = '';
                recipesData.forEach((d, i) => {
                    var uid = 'recipe-'+i;
                    html += `<div class="card" style="margin-bottom:12px;">
                        <div class="card-header bg-rose-light" onclick="app.toggleCard('${uid}')">
                            <span class="font-bold text-slate-700">${d.date}</span>
                            <svg class="chevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                        </div>
                        <div id="${uid}" class="card-body">
                            ${d.meals.map(m => `
                                <div style="margin-bottom:16px; border-bottom:1px dashed #eee; padding-bottom:16px;">
                                    <div class="item-label" style="color:var(--rose-600)">${m.t}</div>
                                    <div class="recipe-section" style="padding:8px; background:#f8fafc; border-radius:8px; margin-top:4px;">
                                        <div class="recipe-section-title" style="font-size:0.7rem; font-weight:800; color:#64748b;">ü•£ Ingredientes</div>
                                        <ul class="ingredients-list" style="margin:0; padding-left:16px; font-size:0.85rem;">
                                            ${Array.isArray(m.ingredients) ? m.ingredients.map(ing => `<li>${ing}</li>`).join('') : `<li>${m.ingredients}</li>`}
                                        </ul>
                                    </div>
                                    <div class="recipe-section" style="padding:8px; background:#fff7ed; border-radius:8px; margin-top:8px;">
                                        <div class="recipe-section-title" style="font-size:0.7rem; font-weight:800; color:#c2410c;">üî• Preparo</div>
                                        <ol class="steps-list" style="margin:0; padding-left:16px; font-size:0.85rem;">
                                            ${Array.isArray(m.st) ? m.st.map(s => `<li>${s}</li>`).join('') : `<li>${m.st}</li>`}
                                        </ol>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>`;
                });
                this.dom.contentArea.innerHTML = html;
            },

            toggleCard: function(id) {
                var el = document.getElementById(id);
                if(el) {
                    if(el.style.display === 'none') {
                        el.style.display = 'block';
                    } else {
                        el.style.display = 'none';
                    }
                }
            },

            renderMembers: function() {
                var html = '<div class="grid">';
                membersGroups.forEach((g) => {
                    html += `<div class="card">
                        <div class="card-header bg-rose-light uppercase text-xs font-black">${g.title || 'Grupo ' + g.id}</div>
                        <div class="card-body text-sm">
                            ${g.list ? `<div class="text-center font-bold text-slate-400 py-2">${g.list}</div>` : `
                                <div class="mb-2"><span class="text-rose-500 font-bold">‚ôÄ Elas:</span><br><span class="text-slate-600">${g.female}</span></div>
                                <div><span class="text-blue-500 font-bold">‚ôÇ Eles:</span><br><span class="text-slate-600">${g.male}</span></div>
                            `}
                        </div>
                    </div>`;
                });
                this.dom.contentArea.innerHTML = html + '</div>';
            },

            renderContacts: function() {
                this.dom.contentArea.innerHTML = `
                <div class="grid">
                    <div class="card" style="border: 2px solid var(--yellow-500);">
                        <div class="card-header bg-yellow-light uppercase text-xs font-black">üìç S√≠tio Casal Vida</div>
                        <div class="card-body">
                            <div class="contact-item">
                                <strong>Endere√ßo:</strong> Ibi√∫na ‚Äì SP<br>
                                <strong>Plus Code:</strong> 7PXG+GV<br>
                                <a href="https://maps.app.goo.gl/JwUkEGykifmq9f3m9" target="_blank" class="contact-link">Abrir no Maps</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header bg-slate-100 uppercase text-xs font-black">üõí Supermercados</div>
                        <div class="card-body text-sm">
                            <div class="contact-item">
                                <div class="font-bold">Supermercado Ibi√∫na</div>
                                üìù Maior supermercado da regi√£o, por√©m costuma ficar bem lotado<br>
                                <a href="https://maps.app.goo.gl/pBFgjAiGb1DDdDr9" target="_blank" class="contact-link">Como chegar</a>
                            </div>
                            <div class="contact-item">
                                <div class="font-bold">Serrano Supermercados ‚Äì LJ 13</div>
                                üìù Possui padaria no local<br>
                                <a href="https://maps.app.goo.gl/N8D8v6EVV3k1kXTN7" target="_blank" class="contact-link">Como chegar</a>
                            </div>
                            <div class="contact-item">
                                <div class="font-bold">Serrano Supermercados ‚Äì LJ 09</div>
                                <a href="https://maps.app.goo.gl/Px3cR5JQpj2rRf2z8" target="_blank" class="contact-link">Como chegar</a>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header bg-orange-50 uppercase text-xs font-black">ü•ê Padarias</div>
                        <div class="card-body text-sm">
                            <div class="contact-item">
                                <div class="font-bold">Padaria Machado</div>
                                <a href="https://www.google.com/maps/search/Padaria+Machado+Ibi√∫na" target="_blank" class="contact-link">Ver Mapa</a>
                            </div>
                            <div class="contact-item">
                                <div class="font-bold">Padaria Princesa de Ibi√∫na</div>
                                <a href="https://www.google.com/maps/search/Padaria+Princesa+de+Ibi√∫na" target="_blank" class="contact-link">Ver Mapa</a>
                            </div>
                        </div>
                    </div>

                    <div class="card" style="border: 2px solid var(--red-600);">
                        <div class="card-header bg-red-50 uppercase text-xs font-black text-red-600">üè• Emerg√™ncia</div>
                        <div class="card-body text-sm">
                            <div class="contact-item">
                                <div class="font-bold">Hospital Municipal Ibi√∫na</div>
                                üìç Av. Gabriel Monteiro da Silva, 888<br>
                                üìû (15) 3248-9520<br>
                                <a href="https://www.google.com/maps/search/Hospital+Municipal+de+Ibi√∫na" target="_blank" class="contact-link">Abrir Rota</a>
                            </div>
                        </div>
                    </div>
                </div>`;
            },

            renderSOS: function() {
                this.dom.contentArea.innerHTML = `
                <div style="text-align:center; padding: 20px;">
                    <div style="font-size: 4rem; margin-bottom: 20px;">üöë</div>
                    <h2 style="color:var(--red-600); font-weight:800;">EMERG√äNCIA</h2>
                    <p style="color:var(--slate-500); margin-bottom: 30px;">Em caso de acidentes graves, mantenha a calma e ligue imediatamente.</p>
                    
                    <a href="tel:192" class="card" style="background:var(--red-600); color:white; text-decoration:none; padding:20px; margin-bottom:16px; display:block; border-radius:16px;">
                        <div style="font-size:1.5rem; font-weight:800;">SAMU 192</div>
                        <div style="font-size:0.9rem; opacity:0.9;">Ambul√¢ncia P√∫blica</div>
                    </a>

                    <a href="tel:193" class="card" style="background:var(--slate-800); color:white; text-decoration:none; padding:20px; margin-bottom:16px; display:block; border-radius:16px;">
                        <div style="font-size:1.5rem; font-weight:800;">BOMBEIROS 193</div>
                        <div style="font-size:0.9rem; opacity:0.9;">Resgate e Inc√™ndio</div>
                    </a>

                    <div class="card">
                        <div class="card-header bg-red-50">üè• Hospital Municipal</div>
                        <div class="card-body">
                            <div class="font-bold text-lg">Hospital Municipal de Ibi√∫na</div>
                            <div class="text-slate-500 mb-4">Av. Gabriel Monteiro da Silva, 888</div>
                            <a href="https://maps.app.goo.gl/HospitalMunicipalIbiuna" target="_blank" style="display:block; width:100%; padding:12px; background:var(--blue-50); color:var(--blue-600); text-align:center; border-radius:8px; font-weight:bold; text-decoration:none;">Abrir GPS</a>
                        </div>
                    </div>
                </div>`;
            }
        };

        // --- 3. INICIALIZA√á√ÉO ---
        window.onload = function() {
            app.init();
        };
    </script>
</body>
</html>
