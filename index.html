<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Manual do Sítio • Final de Ano</title>
<style>
:root{
  --bg:#0b1220;--panel:#0f1b33;--panel2:#101e3a;--text:#eaf0ff;--muted:#a8b3d6;
  --brand:#7c5cff;--brand2:#22c55e;--danger:#ef4444;--warn:#f59e0b;
  --border:rgba(255,255,255,.10);--shadow:0 18px 50px rgba(0,0,0,.35);--radius:18px;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial,sans-serif;background:radial-gradient(1200px 700px at 20% 0%, rgba(124,92,255,.25), transparent 60%),radial-gradient(900px 600px at 80% 0%, rgba(34,197,94,.18), transparent 55%),var(--bg);color:var(--text)}
a{color:#b9a7ff;text-decoration:none} a:hover{text-decoration:underline}
.container{max-width:1150px;margin:0 auto;padding:22px}
.header{display:flex;gap:16px;align-items:flex-start;justify-content:space-between;flex-wrap:wrap}
.brand{display:flex;gap:14px;align-items:center}
.logo{width:44px;height:44px;border-radius:14px;background:linear-gradient(145deg, rgba(124,92,255,.95), rgba(34,197,94,.65));box-shadow:var(--shadow)}
.h1{margin:0;font-size:22px;letter-spacing:.2px}
.sub{margin:4px 0 0 0;color:var(--muted);font-size:13px;line-height:1.35}
.card{background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}
.tabs{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
.tabbtn{border:1px solid var(--border);background:rgba(255,255,255,.04);color:var(--text);padding:10px 12px;border-radius:14px;cursor:pointer;font-weight:650;font-size:13px}
.tabbtn[aria-selected="true"]{background:rgba(124,92,255,.22);border-color:rgba(124,92,255,.45)}
.grid{display:grid;gap:14px}
@media (min-width: 980px){.grid.cols2{grid-template-columns:1fr 1fr}}
.section{padding:18px}
.section h2{margin:0 0 10px 0;font-size:18px}
.p{margin:0;color:var(--muted);line-height:1.6}
.kpi{display:flex;gap:12px;flex-wrap:wrap}
.kpi .box{flex:1 1 220px;padding:12px 12px;border-radius:16px;background:rgba(0,0,0,.18);border:1px solid var(--border)}
.kpi .lbl{font-size:12px;color:var(--muted);margin-bottom:3px}
.kpi .val{font-size:18px;font-weight:800}
.hr{height:1px;background:var(--border);margin:14px 0}
.tablewrap{overflow:auto;border-radius:16px;border:1px solid var(--border)}
table{width:100%;border-collapse:separate;border-spacing:0;min-width:720px}
thead th{position:sticky;top:0;background:rgba(10,18,32,.95);backdrop-filter:blur(8px);border-bottom:1px solid var(--border);text-align:left;padding:10px 12px;font-size:12px;color:var(--muted);z-index:1}
tbody td{border-bottom:1px solid rgba(255,255,255,.06);padding:10px 12px;font-size:13px;vertical-align:top}
tbody tr:hover td{background:rgba(255,255,255,.03)}
.badge{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--border);padding:6px 10px;border-radius:999px;font-size:12px;color:var(--muted);background:rgba(255,255,255,.03)}
.badge b{color:var(--text)}
.pill{display:inline-block;padding:5px 9px;border-radius:999px;font-size:12px;font-weight:750}
.pill.ok{background:rgba(34,197,94,.18);border:1px solid rgba(34,197,94,.35)}
.pill.warn{background:rgba(245,158,11,.15);border:1px solid rgba(245,158,11,.35)}
.pill.bad{background:rgba(239,68,68,.14);border:1px solid rgba(239,68,68,.35)}
.small{font-size:12px;color:var(--muted)}
.input{width:100%;max-width:160px;padding:8px 10px;border-radius:12px;border:1px solid var(--border);background:rgba(0,0,0,.20);color:var(--text)}
.controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
.controls .left{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.btn{cursor:pointer;border:1px solid var(--border);background:rgba(255,255,255,.04);color:var(--text);padding:9px 12px;border-radius:14px;font-weight:700;font-size:13px}
.btn.primary{background:rgba(124,92,255,.22);border-color:rgba(124,92,255,.45)}
.btn.danger{background:rgba(239,68,68,.14);border-color:rgba(239,68,68,.35)}
.footer{margin-top:16px;padding:14px 16px;border-top:1px solid var(--border);color:var(--muted);font-size:12px}
.note{padding:12px 14px;border-radius:16px;border:1px solid var(--border);background:rgba(0,0,0,.16)}
.collapsible{border:1px solid var(--border);border-radius:16px;overflow:hidden;background:rgba(0,0,0,.15)}
.collapsible summary{cursor:pointer;list-style:none;padding:12px 14px;font-weight:800}
.collapsible summary::-webkit-details-marker{display:none}
.collapsible .content{padding:0 14px 14px 14px;color:var(--muted);line-height:1.55}
.floatTotal{position:sticky;bottom:12px;display:flex;justify-content:flex-end;margin-top:10px}
.totalBox{display:flex;gap:10px;align-items:center;padding:10px 12px;border-radius:16px;border:1px solid var(--border);background:rgba(10,18,32,.92);backdrop-filter:blur(10px)}
.totalBox .t{font-weight:900}
.checkbox{transform:scale(1.1)}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1 class="h1">Manual do Sítio • Final de Ano</h1>
        <p class="sub">Página única (HTML) pronta para GitHub Pages. Inclui: escala de limpeza, lista geral de compras (com itens de limpeza), contatos e orientações.</p>
      </div>
    </div>
    <div class="badge"><b>Offline</b><span>•</span><span id="statusTxt">pronto para publicar</span></div>
  </div>

  <div class="tabs" role="tablist" aria-label="Seções">
    <button class="tabbtn" role="tab" aria-selected="true" data-tab="home">Visão geral</button>
    <button class="tabbtn" role="tab" aria-selected="false" data-tab="compras">Lista de compras</button>
    <button class="tabbtn" role="tab" aria-selected="false" data-tab="limpeza">Escala de limpeza</button>
    <button class="tabbtn" role="tab" aria-selected="false" data-tab="contatos">Contatos</button>
  </div>

  <div class="card" style="margin-top:14px">
    <div class="section" id="tab-home" role="tabpanel">
      <div class="grid cols2">
        <div class="note">
          <h2>Como publicar no GitHub Pages</h2>
          <ol class="p">
            <li>Abra seu repositório no GitHub.</li>
            <li>Vá em <b>Add file → Upload files</b>.</li>
            <li>Envie este arquivo com o nome <b>index.html</b> (na raiz do repositório).</li>
            <li>Clique em <b>Commit changes</b>.</li>
            <li>Em seguida: <b>Settings → Pages</b> → Source: <b>Deploy from a branch</b> → Branch: <b>main</b> e pasta <b>/(root)</b> → Save.</li>
          </ol>
          <div class="hr"></div>
          <p class="small">Se o menu “Pages” não aparecer: confirme se o repositório é público ou se seu plano permite Pages e se você tem permissão de admin no repo.</p>
        </div>

        <div class="note">
          <h2>O que esta página faz</h2>
          <div class="kpi">
            <div class="box">
              <div class="lbl">Lista de compras</div>
              <div class="val" id="kpiItens">—</div>
              <div class="small">Itens totais (inclui limpeza)</div>
            </div>
            <div class="box">
              <div class="lbl">Departamentos</div>
              <div class="val" id="kpiDeps">—</div>
              <div class="small">Agrupado por categoria</div>
            </div>
            <div class="box">
              <div class="lbl">Persistência</div>
              <div class="val">Local</div>
              <div class="small">Checklist e preços ficam salvos no navegador</div>
            </div>
          </div>
          <div class="hr"></div>
          <p class="p">A lista de compras permite marcar itens já comprados e ajustar preços, recalculando o total em tempo real. A escala de limpeza foi ajustada para que o grupo do Guilherme não atue no dia 30 e para refletir a troca Eliane ↔ Michele.</p>
        </div>
      </div>
      <div class="footer">“Tudo o que fizerem, façam de todo o coração, como para o Senhor…” (Cl 3:23)</div>
    </div>

    <div class="section" id="tab-compras" role="tabpanel" hidden>
      <div class="controls">
        <div class="left">
          <span class="badge"><b id="itensCount">—</b> itens</span>
          <span class="badge"><b id="depsCount">—</b> departamentos</span>
          <label class="badge" style="gap:10px">
            <span>Filtrar:</span>
            <select id="depFilter" class="input" style="max-width:260px"></select>
          </label>
          <label class="badge" style="gap:10px">
            <span>Buscar:</span>
            <input id="searchBox" class="input" style="max-width:280px" placeholder="ex.: detergente, frango, papel..."/>
          </label>
        </div>
        <div class="left">
          <button class="btn" id="btnPrint">Imprimir / PDF</button>
          <button class="btn danger" id="btnReset">Limpar checklist</button>
        </div>
      </div>

      <div class="hr"></div>
      <div id="comprasWrap"></div>

      <div class="floatTotal">
        <div class="totalBox">
          <div class="small">Total estimado:</div>
          <div class="t" id="totalEstimado">R$ 0,00</div>
        </div>
      </div>

      <div class="footer">Dica: ajuste o preço unitário se necessário. A soma usa “Quantidade Total × Preço Unitário”.</div>
    </div>

    <div class="section" id="tab-limpeza" role="tabpanel" hidden>
      <h2>Escala de limpeza (ajustada)</h2>
      <p class="p">Premissas aplicadas: (1) grupo do Guilherme não atua em <b>30/12</b>; (2) troca no grupo das mulheres: <b>Eliane → G3</b> e <b>Michele → G2</b>. A distribuição abaixo mantém rotação e evita concentração excessiva de carga no mesmo grupo.</p>
      <div class="hr"></div>
      <div class="grid cols2">
        <div class="note">
          <h2>Grupos</h2>
          <div id="gruposBox" class="p"></div>
        </div>
        <div class="note">
          <h2>Regras rápidas</h2>
          <ul class="p">
            <li><b>Café:</b> preparo + louça do café.</li>
            <li><b>Almoço:</b> preparo (mulheres) + louça (homens).</li>
            <li><b>Jantar:</b> preparo (mulheres) + louça (homens).</li>
            <li>Se algum dia precisar de ajuste (imprevisto), a troca recomendada é manter <b>o mesmo tipo</b> (M por M / F por F) e equilibrar o “dia de atuação” por grupo.</li>
          </ul>
        </div>
      </div>
      <div class="hr"></div>
      <div class="tablewrap">
        <table>
          <thead>
            <tr>
              <th>Dia</th>
              <th>Café</th>
              <th>Almoço (preparo)</th>
              <th>Almoço (louça)</th>
              <th>Jantar (preparo)</th>
              <th>Jantar (louça)</th>
            </tr>
          </thead>
          <tbody id="limpezaBody"></tbody>
        </table>
      </div>
      <div class="footer">Observação: no sábado (04/01) não há jantar na escala.</div>
    </div>

    <div class="section" id="tab-contatos" role="tabpanel" hidden>
      <h2>Contatos úteis</h2>
      <div class="grid cols2">
        <div class="collapsible" open>
          <summary>Supermercados (Ibiúna)</summary>
          <div class="content" id="contatosMercado"></div>
        </div>
        <div class="collapsible" open>
          <summary>Checklist de emergência rápida</summary>
          <div class="content">
            <ul>
              <li>Defina 1 ponto de encontro e mantenha lanternas carregadas.</li>
              <li>Se houver crianças, mantenha portas e áreas de risco supervisionadas.</li>
              <li>Itens essenciais: analgésico, antitérmico, curativos, antisséptico, repelente.</li>
              <li>Tenha endereço/localização do sítio salvo e compartilhado com todos.</li>
            </ul>
          </div>
        </div>
      </div>
      <div class="footer">Sugestão: salve os links no WhatsApp do grupo e fixe uma mensagem com contatos e rotas.</div>
    </div>

  </div>
</div>

<script>
/** =======================
 *  Dados (sem dependências)
 *  ======================= */
const COMPRAS = [{"departamento": "Descartáveis", "item": "Copo descartável 200ml", "unidade": "pct (100 un)", "quantidade": 15.0, "preco": 12.0}, {"departamento": "Frios e Laticínios", "item": "Manteiga/Margarina", "unidade": "kg", "quantidade": 3.0, "preco": 22.0}, {"departamento": "Frios e Laticínios", "item": "Queijo (mussarela/coalho)", "unidade": "kg", "quantidade": 6.0, "preco": 35.0}, {"departamento": "Frios e Laticínios", "item": "Presunto", "unidade": "kg", "quantidade": 4.0, "preco": 28.0}, {"departamento": "Bebidas", "item": "Suco natural (Campo Verde/garrafa)", "unidade": "L", "quantidade": 40.0, "preco": 65.0}, {"departamento": "Bebidas", "item": "Água mineral (galão 20L)", "unidade": "un", "quantidade": 10.0, "preco": 20.0}, {"departamento": "Padaria", "item": "Ingredientes pão caseiro", "unidade": "kit", "quantidade": 4.0, "preco": 25.0}, {"departamento": "Frios e Laticínios", "item": "Creme de leite", "unidade": "cx", "quantidade": 10.0, "preco": 48.0}, {"departamento": "Padaria", "item": "Pão de alho", "unidade": "un", "quantidade": 60.0, "preco": 28.0}, {"departamento": "Padaria", "item": "Pão de hot dog", "unidade": "un", "quantidade": 50.0, "preco": 12.0}, {"departamento": "Padaria", "item": "Pão francês", "unidade": "un", "quantidade": 260.0, "preco": 1.0}, {"departamento": "Hortifruti", "item": "Pimentão", "unidade": "kg", "quantidade": 6.0, "preco": 95.0}, {"departamento": "Hortifruti", "item": "Limão", "unidade": "kg", "quantidade": 12.0, "preco": 75.0}, {"departamento": "Hortifruti", "item": "Cenoura", "unidade": "kg", "quantidade": 12.0, "preco": 65.0}, {"departamento": "Hortifruti", "item": "Batata", "unidade": "kg", "quantidade": 20.0, "preco": 69.0}, {"departamento": "Padaria", "item": "Pão de hambúrguer", "unidade": "un", "quantidade": 50.0, "preco": 16.0}, {"departamento": "Hortifruti", "item": "Cebola", "unidade": "kg", "quantidade": 20.0, "preco": 75.0}, {"departamento": "Frios e Laticínios", "item": "Champignon", "unidade": "kg", "quantidade": 1.0, "preco": 35.0}, {"departamento": "Mercado", "item": "Sal grosso", "unidade": "kg", "quantidade": 5.0, "preco": 45.0}, {"departamento": "Limpeza", "item": "Saco de lixo 100L", "unidade": "rolo", "quantidade": 6.0, "preco": 22.0}, {"departamento": "Limpeza", "item": "Sabonete líquido (mãos)", "unidade": "un", "quantidade": 2.0, "preco": 18.0}, {"departamento": "Limpeza", "item": "Sabão em pó", "unidade": "kg", "quantidade": 2.0, "preco": 18.0}, {"departamento": "Limpeza", "item": "Pano multiuso", "unidade": "un", "quantidade": 10.0, "preco": 6.0}, {"departamento": "Limpeza", "item": "Pano de chão", "unidade": "un", "quantidade": 10.0, "preco": 8.0}, {"departamento": "Limpeza", "item": "Limpador banheiro (cremoso/pinho)", "unidade": "un", "quantidade": 4.0, "preco": 12.0}, {"departamento": "Mercado", "item": "Ovos", "unidade": "un", "quantidade": 120.0, "preco": 1.0}, {"departamento": "Limpeza", "item": "Água sanitária", "unidade": "L", "quantidade": 6.0, "preco": 45.0}, {"departamento": "Limpeza", "item": "Esponja", "unidade": "un", "quantidade": 10.0, "preco": 2.0}, {"departamento": "Mercado", "item": "Papel higiênico", "unidade": "pct (12 rolos)", "quantidade": 4.0, "preco": 28.0}, {"departamento": "Mercado", "item": "Álcool 70%", "unidade": "L", "quantidade": 2.0, "preco": 12.0}, {"departamento": "Mercado", "item": "Temperos variados (pimenta, orégano, etc.)", "unidade": "kit", "quantidade": 1.0, "preco": 50.0}, {"departamento": "Mercado", "item": "Massa de pastel", "unidade": "rolo", "quantidade": 10.0, "preco": 18.0}, {"departamento": "Mercado", "item": "Carvão", "unidade": "saco", "quantidade": 5.0, "preco": 35.0}, {"departamento": "Limpeza", "item": "Desinfetante", "unidade": "L", "quantidade": 8.0, "preco": 65.0}, {"departamento": "Hortifruti", "item": "Tomate", "unidade": "kg", "quantidade": 36.0, "preco": 89.0}, {"departamento": "Limpeza", "item": "Detergente", "unidade": "un", "quantidade": 10.0, "preco": 28.0}, {"departamento": "Açougue", "item": "Hambúrguer (patinho)", "unidade": "kg", "quantidade": 7.0, "preco": 4499.0}, {"departamento": "Mercado", "item": "Açúcar", "unidade": "kg", "quantidade": 12.0, "preco": 48.0}, {"departamento": "Mercado", "item": "Sal refinado", "unidade": "kg", "quantidade": 4.0, "preco": 45.0}, {"departamento": "Mercado", "item": "Óleo", "unidade": "L", "quantidade": 6.0, "preco": 85.0}, {"departamento": "Mercado", "item": "Molho de tomate natural", "unidade": "kg", "quantidade": 14.0, "preco": 12.0}, {"departamento": "Mercado", "item": "Macarrão seco", "unidade": "kg", "quantidade": 16.0, "preco": 89.0}, {"departamento": "Mercado", "item": "Arroz", "unidade": "kg", "quantidade": 50.0, "preco": 72.0}, {"departamento": "Mercado", "item": "Café em pó", "unidade": "kg", "quantidade": 10.0, "preco": 30.0}, {"departamento": "Descartáveis", "item": "Papel alumínio", "unidade": "rolo", "quantidade": 3.0, "preco": 12.0}, {"departamento": "Descartáveis", "item": "Bandeja alumínio grande", "unidade": "un", "quantidade": 25.0, "preco": 35.0}, {"departamento": "Descartáveis", "item": "Papel toalha", "unidade": "rolo", "quantidade": 12.0, "preco": 65.0}, {"departamento": "Descartáveis", "item": "Guardanapo", "unidade": "pct", "quantidade": 8.0, "preco": 8.0}, {"departamento": "Descartáveis", "item": "Talheres descartáveis", "unidade": "pct (50 un)", "quantidade": 10.0, "preco": 20.0}, {"departamento": "Descartáveis", "item": "Prato descartável", "unidade": "pct (50 un)", "quantidade": 10.0, "preco": 18.0}, {"departamento": "Hortifruti", "item": "Alface", "unidade": "pé", "quantidade": 40.0, "preco": 45.0}, {"departamento": "Descartáveis", "item": "Bandeja alumínio média", "unidade": "un", "quantidade": 30.0, "preco": 28.0}, {"departamento": "Mercado", "item": "Leite", "unidade": "L", "quantidade": 60.0, "preco": 48.0}, {"departamento": "Descartáveis", "item": "Filme plástico", "unidade": "rolo", "quantidade": 3.0, "preco": 8.0}, {"departamento": "Mercado", "item": "Batata palha", "unidade": "kg", "quantidade": 6.0, "preco": 31.0}, {"departamento": "Mercado", "item": "Flocão de milho (cuscuz)", "unidade": "kg", "quantidade": 16.5, "preco": 99.0}, {"departamento": "Açougue", "item": "Coxinha da asa", "unidade": "kg", "quantidade": 4.0, "preco": 1799.0}, {"departamento": "Açougue", "item": "Tulipa de frango", "unidade": "kg", "quantidade": 4.0, "preco": 799.0}, {"departamento": "Açougue", "item": "Linguiça toscana", "unidade": "kg", "quantidade": 18.0, "preco": 2699.0}, {"departamento": "Açougue", "item": "Picanha", "unidade": "kg", "quantidade": 4.0, "preco": 6999.0}, {"departamento": "Açougue", "item": "Maminha", "unidade": "kg", "quantidade": 11.0, "preco": 52.0}, {"departamento": "Açougue", "item": "Patinho moído", "unidade": "kg", "quantidade": 21.0, "preco": 4499.0}, {"departamento": "Açougue", "item": "Contra-filé", "unidade": "kg", "quantidade": 6.0, "preco": 5499.0}, {"departamento": "Açougue", "item": "Salsicha", "unidade": "kg", "quantidade": 6.0, "preco": 18.0}, {"departamento": "Mercado", "item": "Mostarda", "unidade": "kg", "quantidade": 4.0, "preco": 12.0}, {"departamento": "Mercado", "item": "Ketchup", "unidade": "kg", "quantidade": 4.0, "preco": 12.0}, {"departamento": "Mercado", "item": "Maionese", "unidade": "kg", "quantidade": 8.0, "preco": 22.0}, {"departamento": "Mercado", "item": "Ervilha", "unidade": "lata", "quantidade": 24.0, "preco": 65.0}, {"departamento": "Mercado", "item": "Milho verde", "unidade": "lata", "quantidade": 24.0, "preco": 6.0}, {"departamento": "Açougue", "item": "Filé de frango", "unidade": "kg", "quantidade": 40.0, "preco": 27.0}, {"departamento": "Mercado", "item": "Farofa", "unidade": "kg", "quantidade": 9.0, "preco": 19.0}, {"departamento": "Bebidas", "item": "Água mineral galão 20L", "unidade": "un", "quantidade": 10.0, "preco": 216.0}, {"departamento": "Bebidas", "item": "Suco natural", "unidade": "L", "quantidade": 40.0, "preco": 78.0}, {"departamento": "Açougue", "item": "Hambúrguer patinho", "unidade": "kg", "quantidade": 7.0, "preco": 5399.0}, {"departamento": "Mercado", "item": "Molho de tomate", "unidade": "kg", "quantidade": 14.0, "preco": 144.0}, {"departamento": "Limpeza", "item": "Limpador multiuso", "unidade": "L", "quantidade": 8.0, "preco": 72.0}, {"departamento": "Limpeza", "item": "Luvas descartáveis", "unidade": "cx", "quantidade": 4.0, "preco": 18.0}, {"departamento": "Mercado", "item": "Feijão", "unidade": "kg", "quantidade": 15.0, "preco": 95.0}, {"departamento": "Mercado", "item": "Macarrão", "unidade": "kg", "quantidade": 16.0, "preco": 1068.0}, {"departamento": "Mercado", "item": "Flocão de milho", "unidade": "kg", "quantidade": 16.5, "preco": 1188.0}, {"departamento": "Limpeza", "item": "Limpador sanitário", "unidade": "un", "quantidade": 6.0, "preco": 99.0}, {"departamento": "Limpeza", "item": "Luvas descartáveis (caixa)", "unidade": "cx", "quantidade": 2.0, "preco": 25.0}, {"departamento": "Limpeza", "item": "Limpador vaso sanitário", "unidade": "un", "quantidade": 6.0, "preco": 12.0}, {"departamento": "Limpeza", "item": "Limpador perfumado multiuso", "unidade": "L", "quantidade": 4.0, "preco": 10.0}, {"departamento": "Limpeza", "item": "Sabão em pó/líquido", "unidade": "kg", "quantidade": 3.0, "preco": 12.0}, {"departamento": "Limpeza", "item": "Esponja multiuso", "unidade": "un", "quantidade": 10.0, "preco": 3.0}, {"departamento": "Limpeza", "item": "Saco de lixo 100L (rolo)", "unidade": "rolo", "quantidade": 8.0, "preco": 35.0}];

const CONTATOS = [
  {
    nome: "Supermercado Ibiúna",
    link: "https://maps.app.goo.gl/pBFgjAiLGb1DDdDr9",
    obs: "Maior de todos, porém extremamente lotado."
  },
  {
    nome: "Serrano Supermercados - LJ 13",
    link: "https://maps.app.goo.gl/N8D8v6EVV3k1kXTN7",
    obs: "Tem padaria também, para comprar pães."
  },
  {
    nome: "Serrano Supermercados - LJ 09",
    link: "https://maps.app.goo.gl/Px3cR5JQpj2rRf2z8",
    obs: ""
  },
];

const GRUPOS = {
  g1m: ["Rafael", "Felipe"],
  g2m: ["Ronei", "Jeferson"],
  g3m: ["Vinicius", "Alex"],
  g4m: ["Guilherme", "Caio"],
  g1f: ["Gabrielly", "Jessica", "Leticia"],
  g2f: ["Denise", "Bruna", "Michele"],
  g3f: ["Jaqueline", "Neia", "Eliane"],
  g4f: ["Marcia", "Tatiane", "Vitoria"],
};

const ESCALA = [
  {
    dia: "30/12 (Seg)",
    cafe: "G1-M",
    almocoPrep: "G3-F",
    almocoLouca: "G2-M",
    jantarPrep: "G1-F",
    jantarLouca: "G2-M",
  },
  {
    dia: "31/12 (Ter)",
    cafe: "G2-M",
    almocoPrep: "G1-F",
    almocoLouca: "G4-M",
    jantarPrep: "G2-F",
    jantarLouca: "G1-M",
  },
  {
    dia: "01/01 (Qua)",
    cafe: "G4-M",
    almocoPrep: "G2-F",
    almocoLouca: "G3-M",
    jantarPrep: "G1-F",
    jantarLouca: "G4-M",
  },
  {
    dia: "02/01 (Qui)",
    cafe: "G1-M",
    almocoPrep: "G3-F",
    almocoLouca: "G2-M",
    jantarPrep: "G2-F",
    jantarLouca: "G4-M",
  },
  {
    dia: "03/01 (Sex)",
    cafe: "G4-M",
    almocoPrep: "G1-F",
    almocoLouca: "G2-M",
    jantarPrep: "G2-F",
    jantarLouca: "G1-M",
  },
  {
    dia: "04/01 (Sáb)",
    cafe: "G1-M",
    almocoPrep: "G2-F",
    almocoLouca: "G1-M",
    jantarPrep: "—",
    jantarLouca: "—",
  },
];

/** =======================
 *  Util
 *  ======================= */
const fmtBRL = (n) => {
  const v = Number(n || 0);
  return v.toLocaleString("pt-BR", { style:"currency", currency:"BRL" });
};
const keyBought = (it) => `bought::${it.departamento}::${it.item}::${it.unidade}`;
const keyPrice = (it) => `price::${it.departamento}::${it.item}::${it.unidade}`;

/** =======================
 *  Tabs
 *  ======================= */
function initTabs(){
  const btns=[...document.querySelectorAll(".tabbtn")];
  const panels={
    home: document.getElementById("tab-home"),
    compras: document.getElementById("tab-compras"),
    limpeza: document.getElementById("tab-limpeza"),
    contatos: document.getElementById("tab-contatos"),
  };
  function show(tab){
    btns.forEach(b=>b.setAttribute("aria-selected", String(b.dataset.tab===tab)));
    Object.entries(panels).forEach(([k,el])=>{ el.hidden = k!==tab; });
    localStorage.setItem("activeTab", tab);
  }
  btns.forEach(b=>b.addEventListener("click", ()=>show(b.dataset.tab)));
  show(localStorage.getItem("activeTab") || "home");
}

/** =======================
 *  Compras
 *  ======================= */
function unique(arr){ return [...new Set(arr)]; }

function getFilteredItems(){
  const dep = document.getElementById("depFilter").value;
  const q = (document.getElementById("searchBox").value || "").trim().toLowerCase();
  return COMPRAS.filter(it=>{
    const okDep = (dep==="__ALL__") ? true : it.departamento===dep;
    const hay = `${it.item} ${it.unidade} ${it.departamento}`.toLowerCase();
    const okQ = q ? hay.includes(q) : true;
    return okDep && okQ;
  });
}

function computeTotal(list){
  let total=0;
  for(const it of list){
    const priceSaved = Number(localStorage.getItem(keyPrice(it)));
    const price = isFinite(priceSaved) && priceSaved>0 ? priceSaved : Number(it.preco||0);
    total += Number(it.quantidade||0) * price;
  }
  return total;
}

function renderCompras(){
  const wrap = document.getElementById("comprasWrap");
  const list = getFilteredItems();

  const grouped={};
  for(const it of list){
    if(!grouped[it.departamento]) grouped[it.departamento]=[];
    grouped[it.departamento].push(it);
  }

  wrap.innerHTML = "";
  const deps = Object.keys(grouped).sort((a,b)=>a.localeCompare(b, "pt-BR"));
  for(const dep of deps){
    const details = document.createElement("details");
    details.className="collapsible";
    details.open = true;

    const summary = document.createElement("summary");
    const count = grouped[dep].length;
    summary.textContent = `${dep} • ${count} item(ns)`;
    details.appendChild(summary);

    const content = document.createElement("div");
    content.className="content";

    const tWrap = document.createElement("div");
    tWrap.className="tablewrap";
    const table = document.createElement("table");
    table.innerHTML = `
      <thead>
        <tr>
          <th style="width:70px">OK</th>
          <th>Item</th>
          <th style="width:110px">Unidade</th>
          <th style="width:130px">Qtd Total</th>
          <th style="width:170px">Preço unit. (R$)</th>
          <th style="width:160px">Custo (R$)</th>
        </tr>
      </thead>
      <tbody></tbody>
    `;
    const tbody = table.querySelector("tbody");

    for(const it of grouped[dep]){
      const tr = document.createElement("tr");

      const bought = localStorage.getItem(keyBought(it))==="1";
      const priceSaved = Number(localStorage.getItem(keyPrice(it)));
      const price = isFinite(priceSaved) && priceSaved>0 ? priceSaved : Number(it.preco||0);
      const cost = Number(it.quantidade||0) * price;

      tr.innerHTML = `
        <td><input class="checkbox" type="checkbox" ${bought?"checked":""} aria-label="marcar comprado"></td>
        <td><b>${it.item}</b><div class="small">${it.departamento}</div></td>
        <td>${it.unidade||""}</td>
        <td>${String(it.quantidade).replace(".",",")}</td>
        <td>
          <input class="input" inputmode="decimal" value="${price.toString().replace(".",",")}" aria-label="preço unitário">
        </td>
        <td><b>${fmtBRL(cost)}</b></td>
      `;

      const ck = tr.querySelector("input[type=checkbox]");
      ck.addEventListener("change", ()=>{
        localStorage.setItem(keyBought(it), ck.checked ? "1":"0");
      });

      const priceInput = tr.querySelector("input.input");
      priceInput.addEventListener("input", ()=>{
        const raw = (priceInput.value||"").replace(/\./g,"").replace(",",".").replace(/[^0-9.]/g,"");
        const v = Number(raw);
        if(isFinite(v)) localStorage.setItem(keyPrice(it), String(v));
        updateTotals();
        // atualizar custo da linha
        const newCost = Number(it.quantidade||0) * (isFinite(v)?v:0);
        tr.lastElementChild.innerHTML = `<b>${fmtBRL(newCost)}</b>`;
      });

      tbody.appendChild(tr);
    }

    tWrap.appendChild(table);
    content.appendChild(tWrap);
    details.appendChild(content);
    wrap.appendChild(details);
  }

  updateTotals();
}

function updateTotals(){
  const list = getFilteredItems();
  document.getElementById("totalEstimado").textContent = fmtBRL(computeTotal(list));
}

function initCompras(){
  const depFilter = document.getElementById("depFilter");
  const deps = unique(COMPRAS.map(i=>i.departamento)).sort((a,b)=>a.localeCompare(b,"pt-BR"));

  depFilter.innerHTML = `<option value="__ALL__">Todos</option>` + deps.map(d=>`<option value="${d}">${d}</option>`).join("");

  document.getElementById("itensCount").textContent = String(COMPRAS.length);
  document.getElementById("depsCount").textContent = String(deps.length);
  document.getElementById("kpiItens").textContent = String(COMPRAS.length);
  document.getElementById("kpiDeps").textContent = String(deps.length);

  depFilter.addEventListener("change", renderCompras);
  document.getElementById("searchBox").addEventListener("input", ()=>{ renderCompras(); });

  document.getElementById("btnReset").addEventListener("click", ()=>{
    // remove apenas chaves do checklist/preço
    for(const it of COMPRAS){
      localStorage.removeItem(keyBought(it));
      localStorage.removeItem(keyPrice(it));
    }
    renderCompras();
  });

  document.getElementById("btnPrint").addEventListener("click", ()=>window.print());

  renderCompras();
}

/** =======================
 *  Limpeza / Contatos
 *  ======================= */
function renderGrupos(){
  const box = document.getElementById("gruposBox");
  const rows = [
    ["G1-Homens", GRUPOS.g1m.join(", ")],
    ["G2-Homens", GRUPOS.g2m.join(", ")],
    ["G3-Homens", GRUPOS.g3m.join(", ")],
    ["G4-Homens", GRUPOS.g4m.join(", ")],
    ["G1-Mulheres", GRUPOS.g1f.join(", ")],
    ["G2-Mulheres", GRUPOS.g2f.join(", ")],
    ["G3-Mulheres", GRUPOS.g3f.join(", ")],
    ["G4-Mulheres", GRUPOS.g4f.join(", ")],
  ];
  box.innerHTML = rows.map(([k,v])=>`<div class="badge" style="margin:6px 6px 0 0"><b>${k}</b> ${v}</div>`).join("");
}

function renderEscala(){
  const body = document.getElementById("limpezaBody");
  body.innerHTML = ESCALA.map(r=>`
    <tr>
      <td><b>${r.dia}</b></td>
      <td>${r.cafe}</td>
      <td>${r.almocoPrep}</td>
      <td>${r.almocoLouca}</td>
      <td>${r.jantarPrep}</td>
      <td>${r.jantarLouca}</td>
    </tr>
  `).join("");
}

function renderContatos(){
  const el = document.getElementById("contatosMercado");
  el.innerHTML = CONTATOS.map(c=>`
    <div class="note" style="margin-top:10px">
      <div style="display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap">
        <div>
          <div style="font-weight:900">${c.nome}</div>
          <div class="small">${c.obs || ""}</div>
        </div>
        <div><a class="btn primary" href="${c.link}" target="_blank" rel="noopener">Abrir no Maps</a></div>
      </div>
    </div>
  `).join("");
}

/** =======================
 *  Boot
 *  ======================= */
document.addEventListener("DOMContentLoaded", ()=>{
  initTabs();
  initCompras();
  renderGrupos();
  renderEscala();
  renderContatos();
});
</script>
</body>
</html>
